@page "/statistics/common"
@using AutoReferenceSystem.WebClient.Logic.Extensions
@using AutoReferenceSystem.WebClient.Models.Statistic
@using AntDesign.Charts


<PageContainer Title="Общая статистика">
    <Breadcrumb>
        <Breadcrumb>
            <BreadcrumbItem>Статистика/Общее</BreadcrumbItem>
        </Breadcrumb>
    </Breadcrumb>
    <Content>
        <span>Здесь вы можете получить пересказ исходного текста, выбрав все необходимые опции.</span>
    </Content>
    <ChildContent>
        <Card>
            <Table 
                DataSource="@_servers"
                TItem="ServerData"
                ScrollY="300px"
                PageSize="25"
                RowKey="@(item => item.Host)"
                @ref="@_table"
                @bind-SelectedRows="_selectedServers"
                Bordered="true"
            >
                <TitleTemplate>
                    <GridRow>
                        <GridCol Span="4">
                            <Title Level="3">Доступные сервера моделей</Title>
                        </GridCol>
                        <GridCol Span="8" Offset="12">
                            <Search Placeholder="Поиск"/>
                        </GridCol>
                    </GridRow>
                </TitleTemplate>
                <ColumnDefinitions>
                    <Selection Key="@(context.Host)" Type="radio" />
                    <PropertyColumn Property="c=>c.Host" Title="Хост" Sortable/>
                    <PropertyColumn Property="c=>c.Label" Title="Метка" Sortable/>
                    <PropertyColumn Property="c=>c.Models" Title="Размещенные модели" Sortable>
                        @context.Models.Select(m => m.Name).AsOneString()            
                    </PropertyColumn>
                </ColumnDefinitions>
            </Table>
            <Divider />
            <br />
            <br />


            <Title Level="3">Модель: @_selectedServers.FirstOrDefault()?.Models.FirstOrDefault()?.Name</Title>

            <div style="margin-top:2em">
                <GridRow Gutter="(16, 16)">
                    <GridCol Span="12">
                        <Title Level="4">"Запросы на инференс"</Title>
                        <br/>
                        <Line @ref="_inferenceRequestsChart" Data="_inferenceAllRequests" Config="_inferenceRequestsChartConfig"/>
                    </GridCol>
                    <GridCol Span="12">
                        <Title Level="4">"Средняя (общая) загрузка ЦП"</Title>
                        <br />
                        <Line @ref="_cpuUtilizationChart" Data="_cpuUtilizationData" Config="_cpuUtilizationChartConfig" />
                    </GridCol>
                </GridRow>
                <GridRow Gutter="(16, 16)" style="margin-top:2em">
                    <GridCol Span="12">
                        <Title Level="4">"Средняя (общая) загрузка видеокарты"</Title>
                        <br />
                        <Line @ref="_gpuUtilizationChart" Data="_gpuUtilizationData" Config="_gpuUtilizationChartConfig" />
                    </GridCol>
                    <GridCol Span="12">
                        <Title Level="4">"Средняя нагрузка на ОЗУ"</Title>
                        <br />
                        <Line @ref="_memoryUtilizationChart" Data="_memoryUtilizationData" Config="_memoryUtilizationChartConfig" />
                    </GridCol>
                </GridRow>
                <GridRow Gutter="(16, 16)" style="margin-top:2em">
                    <GridCol Span="12">
                        <Title Level="4">"Среднее время обработки запроса"</Title>
                        <br />
                        <Pie @ref="_averageRequestProcessingTimeChart" Data="_averageRequestProcessingTimeData" Config="_averageRequestProcessingTimeChartConfig" />
                    </GridCol>
                    <GridCol Span="12">
                        <Title Level="4">"Разбиение запросов по методу реферирования"</Title>
                        <br />
                        <Pie @ref="_abstractionMethodQueriesSplitChart" Data="_abstractionMethodQueriesSplitData" Config="_abstractionMethodQueriesSplitChartConfig" />
                    </GridCol>
                </GridRow>
            </div>
             <br />
             <br />
         </Card>
     </ChildContent>
 </PageContainer>



